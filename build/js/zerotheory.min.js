var ZeroTheory={MAX_EFFECT_INDEX:3,MAX_AURAS:48,MAX_POSITIVE_AURAS:32,DBC_PATH:"dbcs/",GCD:1500,DEFAULT_RUNTIME:9E5,SM_RUIN:1,DS_RUIN_CORR:2,DS_RUIN_SUPP:3};ZeroTheory.activeSpecc=ZeroTheory.SM_RUIN;
var SpellFamily={SPELLFAMILY_GENERIC:0,SPELLFAMILY_UNK1:1,SPELLFAMILY_MAGE:3,SPELLFAMILY_WARRIOR:4,SPELLFAMILY_WARLOCK:5,SPELLFAMILY_PRIEST:6,SPELLFAMILY_DRUID:7,SPELLFAMILY_ROGUE:8,SPELLFAMILY_HUNTER:9,SPELLFAMILY_PALADIN:10,SPELLFAMILY_SHAMAN:11,SPELLFAMILY_UNK2:12,SPELLFAMILY_POTION:13,SPELLFAMILY_DEATHKNIGHT:15,SPELLFAMILY_UNK3:17},SpellSchools={SPELL_SCHOOL_NORMAL:0,SPELL_SCHOOL_HOLY:1,SPELL_SCHOOL_FIRE:2,SPELL_SCHOOL_NATURE:3,SPELL_SCHOOL_FROST:4,SPELL_SCHOOL_SHADOW:5,SPELL_SCHOOL_ARCANE:6},
SpellSchoolMask={SPELL_SCHOOL_MASK_NONE:0,SPELL_SCHOOL_MASK_NORMAL:1<<SpellSchools.SPELL_SCHOOL_NORMAL,SPELL_SCHOOL_MASK_HOLY:1<<SpellSchools.SPELL_SCHOOL_HOLY,SPELL_SCHOOL_MASK_FIRE:1<<SpellSchools.SPELL_SCHOOL_FIRE,SPELL_SCHOOL_MASK_NATURE:1<<SpellSchools.SPELL_SCHOOL_NATURE,SPELL_SCHOOL_MASK_FROST:1<<SpellSchools.SPELL_SCHOOL_FROST,SPELL_SCHOOL_MASK_SHADOW:1<<SpellSchools.SPELL_SCHOOL_SHADOW,SPELL_SCHOOL_MASK_ARCANE:1<<SpellSchools.SPELL_SCHOOL_ARCANE,SPELL_SCHOOL_MASK_SPELL:124,SPELL_SCHOOL_MASK_MAGIC:126,
SPELL_SCHOOL_MASK_ALL:127,getSchoolMask:function(a){return 1<<a}},SpellEffects={SPELL_EFFECT_NONE:0,SPELL_EFFECT_INSTAKILL:1,SPELL_EFFECT_SCHOOL_DAMAGE:2,SPELL_EFFECT_DUMMY:3,SPELL_EFFECT_PORTAL_TELEPORT:4,SPELL_EFFECT_TELEPORT_UNITS:5,SPELL_EFFECT_APPLY_AURA:6,SPELL_EFFECT_ENVIRONMENTAL_DAMAGE:7,SPELL_EFFECT_POWER_DRAIN:8,SPELL_EFFECT_HEALTH_LEECH:9,SPELL_EFFECT_HEAL:10,SPELL_EFFECT_BIND:11,SPELL_EFFECT_PORTAL:12,SPELL_EFFECT_RITUAL_BASE:13,SPELL_EFFECT_RITUAL_SPECIALIZE:14,SPELL_EFFECT_RITUAL_ACTIVATE_PORTAL:15,
SPELL_EFFECT_QUEST_COMPLETE:16,SPELL_EFFECT_WEAPON_DAMAGE_NOSCHOOL:17,SPELL_EFFECT_RESURRECT:18,SPELL_EFFECT_ADD_EXTRA_ATTACKS:19,SPELL_EFFECT_DODGE:20,SPELL_EFFECT_EVADE:21,SPELL_EFFECT_PARRY:22,SPELL_EFFECT_BLOCK:23,SPELL_EFFECT_CREATE_ITEM:24,SPELL_EFFECT_WEAPON:25,SPELL_EFFECT_DEFENSE:26,SPELL_EFFECT_PERSISTENT_AREA_AURA:27,SPELL_EFFECT_SUMMON:28,SPELL_EFFECT_LEAP:29,SPELL_EFFECT_ENERGIZE:30,SPELL_EFFECT_WEAPON_PERCENT_DAMAGE:31,SPELL_EFFECT_TRIGGER_MISSILE:32,SPELL_EFFECT_OPEN_LOCK:33,SPELL_EFFECT_SUMMON_CHANGE_ITEM:34,
SPELL_EFFECT_APPLY_AREA_AURA_PARTY:35,SPELL_EFFECT_LEARN_SPELL:36,SPELL_EFFECT_SPELL_DEFENSE:37,SPELL_EFFECT_DISPEL:38,SPELL_EFFECT_LANGUAGE:39,SPELL_EFFECT_DUAL_WIELD:40,SPELL_EFFECT_SUMMON_WILD:41,SPELL_EFFECT_SUMMON_GUARDIAN:42,SPELL_EFFECT_TELEPORT_UNITS_FACE_CASTER:43,SPELL_EFFECT_SKILL_STEP:44,SPELL_EFFECT_ADD_HONOR:45,SPELL_EFFECT_SPAWN:46,SPELL_EFFECT_TRADE_SKILL:47,SPELL_EFFECT_STEALTH:48,SPELL_EFFECT_DETECT:49,SPELL_EFFECT_TRANS_DOOR:50,SPELL_EFFECT_FORCE_CRITICAL_HIT:51,SPELL_EFFECT_GUARANTEE_HIT:52,
SPELL_EFFECT_ENCHANT_ITEM:53,SPELL_EFFECT_ENCHANT_ITEM_TEMPORARY:54,SPELL_EFFECT_TAMECREATURE:55,SPELL_EFFECT_SUMMON_PET:56,SPELL_EFFECT_LEARN_PET_SPELL:57,SPELL_EFFECT_WEAPON_DAMAGE:58,SPELL_EFFECT_OPEN_LOCK_ITEM:59,SPELL_EFFECT_PROFICIENCY:60,SPELL_EFFECT_SEND_EVENT:61,SPELL_EFFECT_POWER_BURN:62,SPELL_EFFECT_THREAT:63,SPELL_EFFECT_TRIGGER_SPELL:64,SPELL_EFFECT_HEALTH_FUNNEL:65,SPELL_EFFECT_POWER_FUNNEL:66,SPELL_EFFECT_HEAL_MAX_HEALTH:67,SPELL_EFFECT_INTERRUPT_CAST:68,SPELL_EFFECT_DISTRACT:69,SPELL_EFFECT_PULL:70,
SPELL_EFFECT_PICKPOCKET:71,SPELL_EFFECT_ADD_FARSIGHT:72,SPELL_EFFECT_SUMMON_POSSESSED:73,SPELL_EFFECT_SUMMON_TOTEM:74,SPELL_EFFECT_HEAL_MECHANICAL:75,SPELL_EFFECT_SUMMON_OBJECT_WILD:76,SPELL_EFFECT_SCRIPT_EFFECT:77,SPELL_EFFECT_ATTACK:78,SPELL_EFFECT_SANCTUARY:79,SPELL_EFFECT_ADD_COMBO_POINTS:80,SPELL_EFFECT_CREATE_HOUSE:81,SPELL_EFFECT_BIND_SIGHT:82,SPELL_EFFECT_DUEL:83,SPELL_EFFECT_STUCK:84,SPELL_EFFECT_SUMMON_PLAYER:85,SPELL_EFFECT_ACTIVATE_OBJECT:86,SPELL_EFFECT_SUMMON_TOTEM_SLOT1:87,SPELL_EFFECT_SUMMON_TOTEM_SLOT2:88,
SPELL_EFFECT_SUMMON_TOTEM_SLOT3:89,SPELL_EFFECT_SUMMON_TOTEM_SLOT4:90,SPELL_EFFECT_THREAT_ALL:91,SPELL_EFFECT_ENCHANT_HELD_ITEM:92,SPELL_EFFECT_SUMMON_PHANTASM:93,SPELL_EFFECT_SELF_RESURRECT:94,SPELL_EFFECT_SKINNING:95,SPELL_EFFECT_CHARGE:96,SPELL_EFFECT_SUMMON_CRITTER:97,SPELL_EFFECT_KNOCK_BACK:98,SPELL_EFFECT_DISENCHANT:99,SPELL_EFFECT_INEBRIATE:100,SPELL_EFFECT_FEED_PET:101,SPELL_EFFECT_DISMISS_PET:102,SPELL_EFFECT_REPUTATION:103,SPELL_EFFECT_SUMMON_OBJECT_SLOT1:104,SPELL_EFFECT_SUMMON_OBJECT_SLOT2:105,
SPELL_EFFECT_SUMMON_OBJECT_SLOT3:106,SPELL_EFFECT_SUMMON_OBJECT_SLOT4:107,SPELL_EFFECT_DISPEL_MECHANIC:108,SPELL_EFFECT_SUMMON_DEAD_PET:109,SPELL_EFFECT_DESTROY_ALL_TOTEMS:110,SPELL_EFFECT_DURABILITY_DAMAGE:111,SPELL_EFFECT_SUMMON_DEMON:112,SPELL_EFFECT_RESURRECT_NEW:113,SPELL_EFFECT_ATTACK_ME:114,SPELL_EFFECT_DURABILITY_DAMAGE_PCT:115,SPELL_EFFECT_SKIN_PLAYER_CORPSE:116,SPELL_EFFECT_SPIRIT_HEAL:117,SPELL_EFFECT_SKILL:118,SPELL_EFFECT_APPLY_AREA_AURA_PET:119,SPELL_EFFECT_TELEPORT_GRAVEYARD:120,SPELL_EFFECT_NORMALIZED_WEAPON_DMG:121,
SPELL_EFFECT_122:122,SPELL_EFFECT_SEND_TAXI:123,SPELL_EFFECT_PLAYER_PULL:124,SPELL_EFFECT_MODIFY_THREAT_PERCENT:125,SPELL_EFFECT_126:126,SPELL_EFFECT_127:127,SPELL_EFFECT_128:128,SPELL_EFFECT_129:129,TOTAL_SPELL_EFFECTS:130},SpellMissInfo={SPELL_MISS_NONE:0,SPELL_MISS_MISS:1,SPELL_MISS_RESIST:2,SPELL_MISS_DODGE:3,SPELL_MISS_PARRY:4,SPELL_MISS_BLOCK:5,SPELL_MISS_EVADE:6,SPELL_MISS_IMMUNE:7,SPELL_MISS_IMMUNE2:8,SPELL_MISS_DEFLECT:9,SPELL_MISS_ABSORB:10,SPELL_MISS_REFLECT:11},SpellHitType={SPELL_HIT_TYPE_UNK1:1,
SPELL_HIT_TYPE_CRIT:2,SPELL_HIT_TYPE_UNK3:4,SPELL_HIT_TYPE_UNK4:8,SPELL_HIT_TYPE_UNK5:16,SPELL_HIT_TYPE_UNK6:32},SpellDmgClass={SPELL_DAMAGE_CLASS_NONE:0,SPELL_DAMAGE_CLASS_MAGIC:1,SPELL_DAMAGE_CLASS_MELEE:2,SPELL_DAMAGE_CLASS_RANGED:3},DamageEffectType={DIRECT_DAMAGE:0,SPELL_DIRECT_DAMAGE:1,DOT:2,HEAL:3,NODAMAGE:4,SELF_DAMAGE:5},AuraType={SPELL_AURA_NONE:0,SPELL_AURA_BIND_SIGHT:1,SPELL_AURA_MOD_POSSESS:2,SPELL_AURA_PERIODIC_DAMAGE:3,SPELL_AURA_DUMMY:4,SPELL_AURA_MOD_CONFUSE:5,SPELL_AURA_MOD_CHARM:6,
SPELL_AURA_MOD_FEAR:7,SPELL_AURA_PERIODIC_HEAL:8,SPELL_AURA_MOD_ATTACKSPEED:9,SPELL_AURA_MOD_THREAT:10,SPELL_AURA_MOD_TAUNT:11,SPELL_AURA_MOD_STUN:12,SPELL_AURA_MOD_DAMAGE_DONE:13,SPELL_AURA_MOD_DAMAGE_TAKEN:14,SPELL_AURA_DAMAGE_SHIELD:15,SPELL_AURA_MOD_STEALTH:16,SPELL_AURA_MOD_STEALTH_DETECT:17,SPELL_AURA_MOD_INVISIBILITY:18,SPELL_AURA_MOD_INVISIBILITY_DETECTION:19,SPELL_AURA_OBS_MOD_HEALTH:20,SPELL_AURA_OBS_MOD_MANA:21,SPELL_AURA_MOD_RESISTANCE:22,SPELL_AURA_PERIODIC_TRIGGER_SPELL:23,SPELL_AURA_PERIODIC_ENERGIZE:24,
SPELL_AURA_MOD_PACIFY:25,SPELL_AURA_MOD_ROOT:26,SPELL_AURA_MOD_SILENCE:27,SPELL_AURA_REFLECT_SPELLS:28,SPELL_AURA_MOD_STAT:29,SPELL_AURA_MOD_SKILL:30,SPELL_AURA_MOD_INCREASE_SPEED:31,SPELL_AURA_MOD_INCREASE_MOUNTED_SPEED:32,SPELL_AURA_MOD_DECREASE_SPEED:33,SPELL_AURA_MOD_INCREASE_HEALTH:34,SPELL_AURA_MOD_INCREASE_ENERGY:35,SPELL_AURA_MOD_SHAPESHIFT:36,SPELL_AURA_EFFECT_IMMUNITY:37,SPELL_AURA_STATE_IMMUNITY:38,SPELL_AURA_SCHOOL_IMMUNITY:39,SPELL_AURA_DAMAGE_IMMUNITY:40,SPELL_AURA_DISPEL_IMMUNITY:41,
SPELL_AURA_PROC_TRIGGER_SPELL:42,SPELL_AURA_PROC_TRIGGER_DAMAGE:43,SPELL_AURA_TRACK_CREATURES:44,SPELL_AURA_TRACK_RESOURCES:45,SPELL_AURA_46:46,SPELL_AURA_MOD_PARRY_PERCENT:47,SPELL_AURA_48:48,SPELL_AURA_MOD_DODGE_PERCENT:49,SPELL_AURA_MOD_BLOCK_SKILL:50,SPELL_AURA_MOD_BLOCK_PERCENT:51,SPELL_AURA_MOD_CRIT_PERCENT:52,SPELL_AURA_PERIODIC_LEECH:53,SPELL_AURA_MOD_HIT_CHANCE:54,SPELL_AURA_MOD_SPELL_HIT_CHANCE:55,SPELL_AURA_TRANSFORM:56,SPELL_AURA_MOD_SPELL_CRIT_CHANCE:57,SPELL_AURA_MOD_INCREASE_SWIM_SPEED:58,
SPELL_AURA_MOD_DAMAGE_DONE_CREATURE:59,SPELL_AURA_MOD_PACIFY_SILENCE:60,SPELL_AURA_MOD_SCALE:61,SPELL_AURA_PERIODIC_HEALTH_FUNNEL:62,SPELL_AURA_PERIODIC_MANA_FUNNEL:63,SPELL_AURA_PERIODIC_MANA_LEECH:64,SPELL_AURA_MOD_CASTING_SPEED_NOT_STACK:65,SPELL_AURA_FEIGN_DEATH:66,SPELL_AURA_MOD_DISARM:67,SPELL_AURA_MOD_STALKED:68,SPELL_AURA_SCHOOL_ABSORB:69,SPELL_AURA_EXTRA_ATTACKS:70,SPELL_AURA_MOD_SPELL_CRIT_CHANCE_SCHOOL:71,SPELL_AURA_MOD_POWER_COST_SCHOOL_PCT:72,SPELL_AURA_MOD_POWER_COST_SCHOOL:73,SPELL_AURA_REFLECT_SPELLS_SCHOOL:74,
SPELL_AURA_MOD_LANGUAGE:75,SPELL_AURA_FAR_SIGHT:76,SPELL_AURA_MECHANIC_IMMUNITY:77,SPELL_AURA_MOUNTED:78,SPELL_AURA_MOD_DAMAGE_PERCENT_DONE:79,SPELL_AURA_MOD_PERCENT_STAT:80,SPELL_AURA_SPLIT_DAMAGE_PCT:81,SPELL_AURA_WATER_BREATHING:82,SPELL_AURA_MOD_BASE_RESISTANCE:83,SPELL_AURA_MOD_REGEN:84,SPELL_AURA_MOD_POWER_REGEN:85,SPELL_AURA_CHANNEL_DEATH_ITEM:86,SPELL_AURA_MOD_DAMAGE_PERCENT_TAKEN:87,SPELL_AURA_MOD_HEALTH_REGEN_PERCENT:88,SPELL_AURA_PERIODIC_DAMAGE_PERCENT:89,SPELL_AURA_MOD_RESIST_CHANCE:90,
SPELL_AURA_MOD_DETECT_RANGE:91,SPELL_AURA_PREVENTS_FLEEING:92,SPELL_AURA_MOD_UNATTACKABLE:93,SPELL_AURA_INTERRUPT_REGEN:94,SPELL_AURA_GHOST:95,SPELL_AURA_SPELL_MAGNET:96,SPELL_AURA_MANA_SHIELD:97,SPELL_AURA_MOD_SKILL_TALENT:98,SPELL_AURA_MOD_ATTACK_POWER:99,SPELL_AURA_AURAS_VISIBLE:100,SPELL_AURA_MOD_RESISTANCE_PCT:101,SPELL_AURA_MOD_MELEE_ATTACK_POWER_VERSUS:102,SPELL_AURA_MOD_TOTAL_THREAT:103,SPELL_AURA_WATER_WALK:104,SPELL_AURA_FEATHER_FALL:105,SPELL_AURA_HOVER:106,SPELL_AURA_ADD_FLAT_MODIFIER:107,
SPELL_AURA_ADD_PCT_MODIFIER:108,SPELL_AURA_ADD_TARGET_TRIGGER:109,SPELL_AURA_MOD_POWER_REGEN_PERCENT:110,SPELL_AURA_ADD_CASTER_HIT_TRIGGER:111,SPELL_AURA_OVERRIDE_CLASS_SCRIPTS:112,SPELL_AURA_MOD_RANGED_DAMAGE_TAKEN:113,SPELL_AURA_MOD_RANGED_DAMAGE_TAKEN_PCT:114,SPELL_AURA_MOD_HEALING:115,SPELL_AURA_MOD_REGEN_DURING_COMBAT:116,SPELL_AURA_MOD_MECHANIC_RESISTANCE:117,SPELL_AURA_MOD_HEALING_PCT:118,SPELL_AURA_SHARE_PET_TRACKING:119,SPELL_AURA_UNTRACKABLE:120,SPELL_AURA_EMPATHY:121,SPELL_AURA_MOD_OFFHAND_DAMAGE_PCT:122,
SPELL_AURA_MOD_TARGET_RESISTANCE:123,SPELL_AURA_MOD_RANGED_ATTACK_POWER:124,SPELL_AURA_MOD_MELEE_DAMAGE_TAKEN:125,SPELL_AURA_MOD_MELEE_DAMAGE_TAKEN_PCT:126,SPELL_AURA_RANGED_ATTACK_POWER_ATTACKER_BONUS:127,SPELL_AURA_MOD_POSSESS_PET:128,SPELL_AURA_MOD_SPEED_ALWAYS:129,SPELL_AURA_MOD_MOUNTED_SPEED_ALWAYS:130,SPELL_AURA_MOD_RANGED_ATTACK_POWER_VERSUS:131,SPELL_AURA_MOD_INCREASE_ENERGY_PERCENT:132,SPELL_AURA_MOD_INCREASE_HEALTH_PERCENT:133,SPELL_AURA_MOD_MANA_REGEN_INTERRUPT:134,SPELL_AURA_MOD_HEALING_DONE:135,
SPELL_AURA_MOD_HEALING_DONE_PERCENT:136,SPELL_AURA_MOD_TOTAL_STAT_PERCENTAGE:137,SPELL_AURA_MOD_MELEE_HASTE:138,SPELL_AURA_FORCE_REACTION:139,SPELL_AURA_MOD_RANGED_HASTE:140,SPELL_AURA_MOD_RANGED_AMMO_HASTE:141,SPELL_AURA_MOD_BASE_RESISTANCE_PCT:142,SPELL_AURA_MOD_RESISTANCE_EXCLUSIVE:143,SPELL_AURA_SAFE_FALL:144,SPELL_AURA_CHARISMA:145,SPELL_AURA_PERSUADED:146,SPELL_AURA_MECHANIC_IMMUNITY_MASK:147,SPELL_AURA_RETAIN_COMBO_POINTS:148,SPELL_AURA_RESIST_PUSHBACK:149,SPELL_AURA_MOD_SHIELD_BLOCKVALUE_PCT:150,
SPELL_AURA_TRACK_STEALTHED:151,SPELL_AURA_MOD_DETECTED_RANGE:152,SPELL_AURA_SPLIT_DAMAGE_FLAT:153,SPELL_AURA_MOD_STEALTH_LEVEL:154,SPELL_AURA_MOD_WATER_BREATHING:155,SPELL_AURA_MOD_REPUTATION_GAIN:156,SPELL_AURA_PET_DAMAGE_MULTI:157,SPELL_AURA_MOD_SHIELD_BLOCKVALUE:158,SPELL_AURA_NO_PVP_CREDIT:159,SPELL_AURA_MOD_AOE_AVOIDANCE:160,SPELL_AURA_MOD_HEALTH_REGEN_IN_COMBAT:161,SPELL_AURA_POWER_BURN_MANA:162,SPELL_AURA_MOD_CRIT_DAMAGE_BONUS:163,SPELL_AURA_164:164,SPELL_AURA_MELEE_ATTACK_POWER_ATTACKER_BONUS:165,
SPELL_AURA_MOD_ATTACK_POWER_PCT:166,SPELL_AURA_MOD_RANGED_ATTACK_POWER_PCT:167,SPELL_AURA_MOD_DAMAGE_DONE_VERSUS:168,SPELL_AURA_MOD_CRIT_PERCENT_VERSUS:169,SPELL_AURA_DETECT_AMORE:170,SPELL_AURA_MOD_SPEED_NOT_STACK:171,SPELL_AURA_MOD_MOUNTED_SPEED_NOT_STACK:172,SPELL_AURA_ALLOW_CHAMPION_SPELLS:173,SPELL_AURA_MOD_SPELL_DAMAGE_OF_STAT_PERCENT:174,SPELL_AURA_MOD_SPELL_HEALING_OF_STAT_PERCENT:175,SPELL_AURA_SPIRIT_OF_REDEMPTION:176,SPELL_AURA_AOE_CHARM:177,SPELL_AURA_MOD_DEBUFF_RESISTANCE:178,SPELL_AURA_MOD_ATTACKER_SPELL_CRIT_CHANCE:179,
SPELL_AURA_MOD_FLAT_SPELL_DAMAGE_VERSUS:180,SPELL_AURA_MOD_FLAT_SPELL_CRIT_DAMAGE_VERSUS:181,SPELL_AURA_MOD_RESISTANCE_OF_STAT_PERCENT:182,SPELL_AURA_MOD_CRITICAL_THREAT:183,SPELL_AURA_MOD_ATTACKER_MELEE_HIT_CHANCE:184,SPELL_AURA_MOD_ATTACKER_RANGED_HIT_CHANCE:185,SPELL_AURA_MOD_ATTACKER_SPELL_HIT_CHANCE:186,SPELL_AURA_MOD_ATTACKER_MELEE_CRIT_CHANCE:187,SPELL_AURA_MOD_ATTACKER_RANGED_CRIT_CHANCE:188,SPELL_AURA_MOD_RATING:189,SPELL_AURA_MOD_FACTION_REPUTATION_GAIN:190,SPELL_AURA_USE_NORMAL_MOVEMENT_SPEED:191,
TOTAL_AURAS:192};ZeroTheory.Utils={debug:!0,console:function(a){if(ZeroTheory.Utils.debug&&"object"===typeof console&&("object"===typeof a||"function"===typeof console[a])){var b=[];if("object"===typeof a)for(var c in a)"function"===typeof console[c]&&(b=a[c].length?a[c]:[a[c]],console[c].apply(console,b));else console[a].apply(console,Array.prototype.slice.call(arguments,1))}}};ZeroTheory.SpellStore=function(){this._loadCount=0;this._spellEntryStore={};this._spellDurationStore={};this._spellCastingTimeStore={};this.loaded=!1;ZeroTheory.SpellStore._load(this)};
ZeroTheory.SpellStore._load=function(a){ZeroTheory.Utils.console("log","SpellStore loading ..");$.getJSON(ZeroTheory.DBC_PATH+"Spell.json",function(b){var c=0;b.fieldIndex={};for(var e in b.fields)b.fieldIndex[e]=c,c++;b.fields=null;a._spellEntryStore=b;ZeroTheory.SpellStore._fileLoadComplete(a);ZeroTheory.Utils.console("log","FILE: ./"+ZeroTheory.DBC_PATH+"Spell.json;\t\tSTATUS: complete;")});$.getJSON(ZeroTheory.DBC_PATH+"SpellDuration.json",function(b){var c=0;b.fieldIndex={};for(var e in b.fields)b.fieldIndex[e]=
c,c++;b.fields=null;a._spellDurationStore=b;ZeroTheory.SpellStore._fileLoadComplete(a);ZeroTheory.Utils.console("log","FILE: ./"+ZeroTheory.DBC_PATH+"SpellDuration.json;\tSTATUS: complete;")});$.getJSON(ZeroTheory.DBC_PATH+"SpellCastTimes.json",function(b){var c=0;b.fieldIndex={};for(var e in b.fields)b.fieldIndex[e]=c,c++;b.fields=null;a._spellCastingTimeStore=b;ZeroTheory.SpellStore._fileLoadComplete(a);ZeroTheory.Utils.console("log","FILE: ./"+ZeroTheory.DBC_PATH+"SpellCastTimes.json;\tSTATUS: complete;")})};
ZeroTheory.SpellStore._fileLoadComplete=function(a){a._loadCount+=1;3<=a._loadCount&&(a.loaded=!0,$("#run").attr("disabled",!1).css({color:"#111111"}))};ZeroTheory.SpellStore.prototype.lookupEntry=function(a){if(!this.loaded||!a)return null;for(var b=0;b<this._spellEntryStore.records.length;b++)if(this._spellEntryStore.records[b][this._spellEntryStore.fieldIndex.ID]==a)return this._remapRecord(this._spellEntryStore.records[b],this._spellEntryStore.fieldIndex);return null};
ZeroTheory.SpellStore.prototype.lookupDuration=function(a){if(!this.loaded||!a)return null;for(var b=0;b<this._spellDurationStore.records.length;b++)if(this._spellDurationStore.records[b][this._spellDurationStore.fieldIndex.ID]==a)return this._remapRecord(this._spellDurationStore.records[b],this._spellDurationStore.fieldIndex);return null};
ZeroTheory.SpellStore.prototype.lookupCastingTime=function(a){if(!this.loaded||!a)return null;for(var b=0;b<this._spellCastingTimeStore.records.length;b++)if(this._spellCastingTimeStore.records[b][this._spellCastingTimeStore.fieldIndex.ID]==a)return this._remapRecord(this._spellCastingTimeStore.records[b],this._spellCastingTimeStore.fieldIndex);return null};ZeroTheory.SpellStore.prototype._remapRecord=function(a,b){var c={},e;for(e in b)c[e]=a[b[e]];return c};
ZeroTheory.SpellStore.prototype.getDuration=function(a){return this.lookupDuration(a.durationIndex)};ZeroTheory.SpellStore.prototype.getCastingTime=function(a){return this.lookupCastingTime(a.castingTimeIndex)};var spellStore=new ZeroTheory.SpellStore;ZeroTheory.Aura=function(a,b,c,e){this.caster=a;this.affects=b;this.owner=c;a=c.spellInfo;this.auraType=a["effectAura"+e];this.value=ZeroTheory.Spell.calculateSimpleValue(a,e);this.miscValue=a["effectMiscValue"+e];this.maxDuration=c.durationInfo.maxDuration;this.duration=c.durationInfo.duration;this.stackAmount=a.stackAmount;switch(a.ID){case 17800:this.stackAmount=4;break;case 17941:this.stackAmount=1}this.charges=this.stackAmount;this.isPeriodic=!1;this.numTicks=this.maxTicks=this.tickTimer=this.periodicTime=
0;switch(this.auraType){case AuraType.SPELL_AURA_PERIODIC_DAMAGE:case AuraType.SPELL_AURA_PERIODIC_DAMAGE_PERCENT:this.isPeriodic=!0;switch(a.spellIconID){case 31:this.periodicTime=3E3;break;case 91:this.periodicTime=6E4;break;case 152:case 313:this.periodicTime=3E3;break;case 544:this.periodicTime=2E3}this.maxTicks=this.duration/this.periodicTime;this.value=this.caster.calculateBaseDamage(this.affects,a,e,this.value);this.value=this.caster.spellDamageBonusDone(this.affects,a,this.value,DamageEffectType.DOT);
this.tickTimer=this.periodicTime}this.lastUpdate=this.applyTime=(new Date).getTime()};ZeroTheory.Aura.prototype.reset=function(){this.isPeriodic&&(this.numTicks=0,this.tickTimer=this.periodicTime);this.duration=this.maxDuration;this.lastUpdate=(new Date).getTime();this.charges=this.stackAmount};ZeroTheory.Aura.prototype.update=function(a){0<this.duration&&(this.duration-=a,this.lastUpdate+=a);this._handleUpdate(a)};
ZeroTheory.Aura.prototype._handleUpdate=function(a){this.isPeriodic&&(this.tickTimer-=a,0>=this.tickTimer&&(this.tickTimer=this.periodicTime,this.numTicks++,this.periodicTick()))};
ZeroTheory.Aura.prototype.periodicTick=function(){switch(this.auraType){case AuraType.SPELL_AURA_PERIODIC_DAMAGE:ZeroTheory.Utils.console("log","Doing tick for %o, tick no: %i",this,this.numTicks);var a=this.owner.spellInfo,b=this.value,b=this.affects.spellDamageBonusTaken(this.caster,a,b,DamageEffectType.DOT);a.spellClassSet==SpellFamily.SPELLFAMILY_WARLOCK&&544==a.spellIconID&&(4>=this.numTicks?b/=2:9<=this.numTicks&&(b+=(b+1)/2));b=this.affects.calculateResist(this.caster,a.school,b,DamageEffectType.DOT,
this.owner.results);0<b&&(313==a.spellIconID&&ZeroTheory.activeSpecc==ZeroTheory.SM_RUIN)&&4>100*Math.random()&&(this.caster.applyOrRefreshSpell(spellStore.lookupEntry(17941)),this.owner.results.procs+=1);this.owner.results.dotDamage+=b}};ZeroTheory.Unit=function(a,b){this.level=a;this.stats={intellect:0,stamina:0,spellHitPct:0,spellCritPct:0,baseSpellCritPct:5,spellPen:0,sp:0,ssp:0,fsp:0};this.resistance=b?b:[0,0,0,0,0,0];this.spellAuraList=[]};ZeroTheory.Unit.prototype.spellHitResult=function(a,b){switch(b.defenseType){case SpellDmgClass.SPELL_DAMAGE_CLASS_MAGIC:return this.magicSpellHitResult(a,b)}return SpellMissInfo.SPELL_MISS_NONE};
ZeroTheory.Unit.prototype.magicSpellHitResult=function(a,b){var c=a.level-this.level,c=3>c?96-c:94-11*(c-2);ZeroTheory.Utils.console("log","modHitChance: %i%",c);var e=0;if(ZeroTheory.activeSpecc==ZeroTheory.SM_RUIN||ZeroTheory.activeSpecc==ZeroTheory.DS_RUIN_SUPP)switch(b.spellIconID){case 55:case 91:case 152:case 313:case 542:case 544:e=10,ZeroTheory.Utils.console("log","Affliction spell and suppression talent detected, adding 10% +hit")}e+=this.stats.spellHitPct;c+=e;ZeroTheory.Utils.console("log",
"Total chance to hit: %i%",c);c*=100;100>c&&(c=100);9900<c&&(c=9900);c=1E4-c;e=Math.floor(10001*Math.random());ZeroTheory.Utils.console("log","Rolled outcome: rand=%i, tmp=%i;",e,c);return e<c?SpellMissInfo.SPELL_MISS_RESIST:SpellMissInfo.SPELL_MISS_NONE};ZeroTheory.Unit.prototype.cast=function(a,b){a.cast(this,b)};
ZeroTheory.Unit.prototype.calculateBaseDamage=function(a,b,c,e){var d=this.level;d>b.maxLevel&&0<b.maxLevel?d=b.maxLevel:d<b.baseLevel&&(d=b.baseLevel);d-=b.spellLevel;a=b["effectBaseDice"+c];var f=b["effectRealPointsPerLevel"+c],g=b["effectDicePerLevel"+c];e=e?e-a:b["effectBasePoints"+c];e+=d*f;d=b["effectDieSides"+c]+d*g;ZeroTheory.Utils.console("log","Spell info: spellLevel: %i; spellMaxLevel: %i; spellBaseLevel: %i;",b.spellLevel,b.maxLevel,b.baseLevel);ZeroTheory.Utils.console("log","baseDice: %i; basePointsPerLevel: %i; randomPointsPerLevel: %i; basePoints: %i; randomPoints: %i;",
a,f,g,e,d);switch(d){case 0<=d:case 1<=d:e+=a;break;default:a=a>=d?Math.floor(Math.random()*(a-d+1))+d:Math.floor(Math.random()*(d-a+1))+a,e+=a}a=e;b.attributes&524288&&(b.spellLevel&&b["effect"+c]!=SpellEffect.SPELL_EFFECT_APPLY_AURA)&&(a=0.25*a*Math.exp(this.level*(70-b.spellLevel)/1E3));ZeroTheory.Utils.console("log","Final value of basePoints: %i;",a);return a};
ZeroTheory.Unit.prototype.calculateSpellDamage=function(a,b,c,e){var d=this.isSpellCrit(a,b);ZeroTheory.Utils.console("log","Spellcast is crit: %s",d?"TRUE":"FALSE");c=this.spellDamageBonusDone(a,b,c,DamageEffectType.SPELL_DIRECT_DAMAGE);c=a.spellDamageBonusTaken(this,b,c,DamageEffectType.SPELL_DIRECT_DAMAGE);if(d){d=1.5;switch(b.spellIconID){case 31:d=2;break;case 213:d=2,a.applyOrRefreshSpell(spellStore.lookupEntry(17800))}e.critResult=SpellHitType.SPELL_HIT_TYPE_CRIT;c*=d;ZeroTheory.Utils.console("log",
"Damage was crit, is now: %d, factor: %d",c,d)}return c?c:0};
ZeroTheory.Unit.prototype.calculateResist=function(a,b,c,e,d){a=this.resistance[b-1];for(var f=0;f<this.spellAuraList.length;f++)this.spellAuraList[f].auraType==AuraType.SPELL_AURA_MOD_RESISTANCE&&0!=(SpellSchoolMask.getSchoolMask(b)&this.spellAuraList[f].miscValue)&&(this.resist+=this.spellAuraList[f].value);a=0<a?a:0;d.resist=0;ZeroTheory.Utils.console("log","%o has %i resistance for school: %i",this,a,b);a*=0.15/this.level;0>a&&(a=0);0.75<a&&(a=0.75);b=100*Math.random();ZeroTheory.Utils.console("log",
"Resistance random component: %d",b);for(var g=[24,6,4,6],h=0,j=0,f=0;4>f;++f)if(j+=2400*Math.pow(a,f)*Math.pow(1-a,4-f)/g[f],b>j)++h;else break;d.resist=e==DamageEffectType.DOT&&4==h?d.resist+(c-1):d.resist+c*h/4;d.resist>c&&(d.resist=c);c-=d.resist;ZeroTheory.Utils.console("log","Resisted damage: %d; remainder: %d;",d.resist,c);return 0<c?c:0};
ZeroTheory.Unit.prototype.spellDamageBonusDone=function(a,b,c,e){a=1;var d=0,f=SpellSchoolMask.getSchoolMask(b.school);ZeroTheory.Utils.console("log","Calculating bonus damage with schoolMask: %i",f);for(var g=0;g<this.spellAuraList.length;g++)this.spellAuraList[g].auraType==AuraType.SPELL_AURA_MOD_DAMAGE_PERCENT_DONE&&0!=(this.spellAuraList[g].miscValue&f)&&(a=a*(this.spellAuraList[g].value+100)/100);ZeroTheory.Utils.console("log","DoneTotalMod is now: %d",a);g=0;switch(b.school){case SpellSchools.SPELL_SCHOOL_FIRE:g=
this.stats.fsp>this.stats.sp?this.stats.fsp:this.stats.sp;break;case SpellSchools.SPELL_SCHOOL_SHADOW:g=this.stats.ssp>this.stats.sp?this.stats.ssp:this.stats.sp}ZeroTheory.Utils.console("log","Caster has %i bonus school spell damage",g);d=this.spellBonusWithCoeffs(b,d,g,e);ZeroTheory.Utils.console("log","Final bonus spell damage: %d",d);b=(c+d)*a;for(g=0;g<this.spellAuraList.length;g++)if(this.spellAuraList[g].miscValue==(e==DamageEffectType.DOT?22:0))b=b*(this.spellAuraList[g].value+100)/100;ZeroTheory.Utils.console("log",
"Flat mod applied, damage now: %d",b);return 0<b?b:0};
ZeroTheory.Unit.prototype.spellDamageBonusTaken=function(a,b,c,e){a=1;for(var d=SpellSchoolMask.getSchoolMask(b.school),f=0;f<this.spellAuraList.length;f++)this.spellAuraList[f].auraType==AuraType.SPELL_AURA_MOD_DAMAGE_PERCENT_TAKEN&&0!=(this.spellAuraList[f].miscValue&d)&&(a=a*(this.spellAuraList[f].value+100)/100,e==DamageEffectType.SPELL_DIRECT_DAMAGE&&(b.school==SpellSchools.SPELL_SCHOOL_SHADOW&&17800==this.spellAuraList[f].owner.spellInfo.ID)&&(this.spellAuraList[f].charges-=1));ZeroTheory.Utils.console("log",
"Damage taken on target %o increased by: %d",this,a);b=(c+0)*a;ZeroTheory.Utils.console("log","Unmitigated damage taken: %d",b);return 0<b?b:0};ZeroTheory.Unit.prototype.spellBonusWithCoeffs=function(a,b,c,e){var d=0;c&&(d=ZeroTheory.Spell.calculateDefaultCoefficient(a,e),c*=d);return b+c};
ZeroTheory.Unit.prototype.isSpellCrit=function(a,b){var c=3.18+this.stats.intellect/(11.3+0.82*this.level);switch(b.spellIconID){case 31:case 213:c+=5}var c=c+this.stats.spellCritPct,e=100*Math.random();ZeroTheory.Utils.console("log","Crit chance: %d; Roll: %d",c,e);return c>e};
ZeroTheory.Unit.prototype.update=function(a){for(var b=this.spellAuraList.length-1;0<=b;b--)this.spellAuraList[b].update(a),0>=this.spellAuraList[b].duration&&0<this.spellAuraList[b].maxDuration?this.spellAuraList.splice(b,1):1>this.spellAuraList[b].charges&&0<this.spellAuraList[b].stackAmount&&this.spellAuraList.splice(b,1)};ZeroTheory.Unit.prototype.applyOrRefreshSpell=function(a){this.hasSpell(a)?this.refreshAurasBySpell(a):(new ZeroTheory.Spell(a)).doAllEffectOnTarget(this)};
ZeroTheory.Unit.prototype.refreshAurasBySpell=function(a){for(var b=0;b<this.spellAuraList.length;b++)this.spellAuraList[b].owner.spellInfo.ID==a.ID&&this.spellAuraList[b].reset()};ZeroTheory.Unit.prototype.removeAurasBySpell=function(a){if(this.hasSpell(a))for(var b=this.spellAuraList.length-1;0<=b;b--)this.spellAuraList[b].owner.spellInfo.ID==a.ID&&this.spellAuraList.splice(b,1)};
ZeroTheory.Unit.prototype.hasSpell=function(a){for(var b=!1,c=0;c<this.spellAuraList.length;c++)if(this.spellAuraList[c].owner.spellInfo.ID==a.ID){b=!0;break}return b};ZeroTheory.Unit.prototype.castSpellOnSelf=function(a){a.doAllEffectOnTarget(this)};ZeroTheory.Spell=function(a,b,c){this.spellInfo=a;this.triggeredBySpellInfo=c?c:null;this.schoolMask=SpellSchoolMask.getSchoolMask(a.school);this.currentBasePoints=[];for(c=0;c<ZeroTheory.MAX_EFFECT_INDEX;c++)this.currentBasePoints[c]=ZeroTheory.Spell.calculateSimpleValue(a,c+1);this.triggeredSpell=b?b:!1;this.results={damage:0,directDamage:0,dotDamage:0,healing:0,hitResult:0,critResult:0,resist:0,procs:0};this.ready=!1};
ZeroTheory.Spell.calculateSimpleValue=function(a,b){return a["effectBasePoints"+b]+a["effectBaseDice"+b]};
ZeroTheory.Spell.calculateDefaultCoefficient=function(a,b){var c=1,e=0;switch(a.spellIconID){case 31:var e=spellStore.getDuration(a).duration,d=spellStore.getCastingTime(a).base,f=e/15E3/(e/15E3+d/3500),g=1-f;if(b==DamageEffectType.DOT)return c/=5,ZeroTheory.Utils.console("log","Immolate dot dmg coeff: %d",e/15E3*f*c),e/15E3*f*c;e=d/3500*g;ZeroTheory.Utils.console("log","Immolate school dmg coeff: %d",e);return e;case 91:return ZeroTheory.Utils.console("log","CoD coeff: %d",2),2;case 152:return e=
spellStore.getDuration(a).duration/15E3,c/=10,e*=c,ZeroTheory.Utils.console("log","SL coeff: %d",e*c/2),e/2;case 313:return e=spellStore.getDuration(a).duration/15E3,c/=6,ZeroTheory.Utils.console("log","Corr coeff: %d",e*c),e*c;case 544:return ZeroTheory.Utils.console("log","CoA coeff: %d",0.12),0.12;default:return d=spellStore.getCastingTime(a).base,ZeroTheory.Utils.console("log","Calculating default coeff with ctime: %i",d),d=(1500>d?1500:d)/1E3,e=d/3.5,2>e?e:2}};
ZeroTheory.Spell.prototype.reset=function(){this.ready=!1};ZeroTheory.Spell.prototype.prepare=function(a){this.caster=a;this.castTimeInfo=spellStore.lookupCastingTime(this.spellInfo.castingTimeIndex);this.durationInfo=spellStore.lookupDuration(this.spellInfo.durationIndex);this.ready=!0};
ZeroTheory.Spell.prototype.cast=function(a,b){this.ready||this.prepare(a);this.results.hitResult=0;this.results.critResult=0;this.results.damage=0;this.results.resist=0;this.results.healing=0;this.results.hitResult=this.caster.spellHitResult(b,this.spellInfo);ZeroTheory.Utils.console("log","Hit result: %s",this.results.hitResult==SpellMissInfo.SPELL_MISS_NONE?"SPELL_MISS_NONE":"SPELL_MISS_RESIST");switch(this.results.hitResult){case SpellMissInfo.SPELL_MISS_NONE:this.doAllEffectOnTarget(b)}};
ZeroTheory.Spell.prototype.doAllEffectOnTarget=function(a){this.ready||this.prepare(a);ZeroTheory.Utils.console("log","Processing effects for target: %o",a);for(var b=1;b<=ZeroTheory.MAX_EFFECT_INDEX;b++)if(0!=this.spellInfo["effect"+b])switch(ZeroTheory.Utils.console("log","Processing effect no: %i",b),this.spellInfo["effect"+b]){case SpellEffects.SPELL_EFFECT_SCHOOL_DAMAGE:this._handleEffectSchoolDamage(b,a);break;case SpellEffects.SPELL_EFFECT_APPLY_AURA:this._handleEffectApplyAura(b,a)}};
ZeroTheory.Spell.prototype.calculateDamage=function(a,b){return this.caster.calculateBaseDamage(b,this.spellInfo,a,this.currentBasePoints[a-1])};ZeroTheory.Spell.prototype.calculateSpellDamage=function(a,b){var c=this.caster.calculateSpellDamage(b,this.spellInfo,this.results.directDamage,this.results),c=b.calculateResist(this.caster,this.spellInfo.school,c,DamageEffectType.SPELL_DIRECT_DAMAGE,this.results);return 0<c?c:0};
ZeroTheory.Spell.prototype._handleEffectSchoolDamage=function(a,b){this.results.directDamage=this.calculateDamage(a,b);this.results.directDamage=this.calculateSpellDamage(a,b);ZeroTheory.Utils.console("log","Final school damage: %i",this.results.directDamage)};ZeroTheory.Spell.prototype._handleEffectApplyAura=function(a,b){b.spellAuraList.push(new ZeroTheory.Aura(this.caster,b,this,a))};ZeroTheory.showAlert=!0;var zt;
$(document).ready(function(){zt=new ZeroTheory.ZeroTheory;$('.stat_input[id!="time"]').blur(function(){var a=$(this).val(),b=$(this).attr("id");a?(a=parseInt(a,10),isNaN(a)?ZeroTheory.showAlert?($(this).val(""),alert("Input must be a number!")):$(this).val(""):(zt.caster.stats[b]=Math.abs(a),ZeroTheory.Utils.console("log","Set zt.caster.stats.%s to %i",b,a))):(zt.caster.stats[b]=0,ZeroTheory.Utils.console("log","Set zt.caster.stats.%s to %i",b,0),$(this).val(""))});$('.stat_input[id="time"]').blur(function(){var a=
$(this).val();a?(a=parseInt(a,10),isNaN(a)?ZeroTheory.showAlert?($(this).val(""),alert("Input must be a number!")):$(this).val(""):(zt.simVars.time=Math.abs(a),ZeroTheory.Utils.console("log","Set zt.simVars.time to %i",a))):(zt.simVars.time=ZeroTheory.DEFAULT_RUNTIME,ZeroTheory.Utils.console("log","Set zt.simVars.time to %i",ZeroTheory.DEFAULT_RUNTIME),$(this).val(""))});$(".spell_input").change(function(){var a=$(this).attr("checked"),b=$(this).attr("id");a?$('select[name="'+b+'Rank"]').attr("disabled",
!1):$('select[name="'+b+'Rank"]').attr("disabled",!0);zt.spellInfo[b]=a;ZeroTheory.Utils.console("log","Set zt.spellInfo.%s to %i",b,!!a);$(this).blur()});$("select").change(function(){var a=$(this).attr("name"),b=$(this).find("option:selected").val();zt.spellInfo[a]=parseInt(b,10);ZeroTheory.Utils.console("log","Set zt.spellInfo.%s to %i",a,b);$(this).blur()});document.getElementById("data_overlay").addEventListener("dragstart",drag_start,!1);document.body.addEventListener("dragover",drag_over,!1);
document.body.addEventListener("drop",drop,!1);$("#data_overlay").hide()});function drag_start(a){var b=window.getComputedStyle(a.target,null);a.dataTransfer.setData("text/plain",parseInt(b.getPropertyValue("left"),10)-a.clientX+","+(parseInt(b.getPropertyValue("top"),10)-a.clientY))}function drag_over(a){a.preventDefault();return!1}
function drop(a){var b=a.dataTransfer.getData("text/plain").split(","),c=document.getElementById("data_overlay");c.style.left=a.clientX+parseInt(b[0],10)+"px";c.style.top=a.clientY+parseInt(b[1],10)+"px";a.preventDefault();return!1}
ZeroTheory.ZeroTheory=function(){this.caster=new ZeroTheory.Unit(60);this.target=new ZeroTheory.Unit(63);this.spellInfo={specc:ZeroTheory.SM_RUIN,curse:17937,useCorr:!0,useCorrRank:11672,useSB:!0,useSBRank:11661,useImmo:!1,useImmoRank:11668,useSL:!1,useSLRank:18881};this.simVars={time:ZeroTheory.DEFAULT_RUNTIME,run:!1}};
ZeroTheory.ZeroTheory.prototype.prepareTalents=function(){ZeroTheory.activeSpecc=this.spellInfo.specc;var a=new ZeroTheory.Spell(spellStore.lookupEntry(18275)),b=new ZeroTheory.Spell(spellStore.lookupEntry(18791));switch(ZeroTheory.activeSpecc){case ZeroTheory.SM_RUIN:this.caster.hasSpell(b.spellInfo)&&this.caster.removeAurasBySpell(b.spellInfo);this.caster.hasSpell(a.spellInfo)||this.caster.castSpellOnSelf(a);break;case ZeroTheory.DS_RUIN_CORR:case ZeroTheory.DS_RUIN_SUPP:this.caster.hasSpell(a.spellInfo)&&
this.caster.removeAurasBySpell(a.spellInfo),this.caster.hasSpell(b.spellInfo)||(b.prepare(this.caster),b.durationInfo.maxDuration=0,b.durationInfo.duration=0,this.caster.castSpellOnSelf(b))}};
ZeroTheory.ZeroTheory.prototype.calculateStatWeightings=function(a){var b=this.simVars.time/1E3,c=a.totals.damage/a.totals.hits,e=(c+10)*a.totals.hits/b-a.totals.dps,d=0;16>this.caster.stats.spellHitPct&&(d=1.01*a.totals.hits-a.totals.hits,d=(a.totals.damage+d*c)/b,d-=a.totals.dps,d/=e);var f=0,f=1.01*a.totals.crits-a.totals.crits,f=(a.totals.damage+f*2*c)/b,f=f-a.totals.dps,f=f/e;return{epValue:e,spToEp:10,hitw:d,critw:f}};
ZeroTheory.ZeroTheory.prototype.resetAuras=function(){this.caster.spellAuraList=[];this.target.spellAuraList=[]};
ZeroTheory.ZeroTheory.prototype.run=function(){this.resetAuras();this.prepareTalents();var a=0,b=this.simVars.time,c=[],e=[];c.push(new ZeroTheory.Spell(spellStore.lookupEntry(this.spellInfo.curse)));e.push({totalDamage:0,hits:0,crits:0,resists:0,partialResistedDamage:0,timeSpentCasting:0,uptime:0});if(this.spellInfo.useCorr){c.push(new ZeroTheory.Spell(spellStore.lookupEntry(this.spellInfo.useCorrRank)));c[c.length-1].prepare(this.caster);if(ZeroTheory.activeSpecc==ZeroTheory.SM_RUIN||ZeroTheory.activeSpecc==
ZeroTheory.DS_RUIN_CORR)c[c.length-1].castTimeInfo.base=0;e.push({totalDamage:0,hits:0,crits:0,resists:0,partialResistedDamage:0,timeSpentCasting:0,uptime:0})}this.spellInfo.useImmo&&(c.push(new ZeroTheory.Spell(spellStore.lookupEntry(this.spellInfo.useImmoRank))),e.push({totalDamage:0,hits:0,crits:0,resists:0,partialResistedDamage:0,timeSpentCasting:0,uptime:0}));this.spellInfo.useSL&&(c.push(new ZeroTheory.Spell(spellStore.lookupEntry(this.spellInfo.useSLRank))),e.push({totalDamage:0,hits:0,crits:0,
resists:0,partialResistedDamage:0,timeSpentCasting:0,uptime:0}));c.push(new ZeroTheory.Spell(spellStore.lookupEntry(this.spellInfo.useSBRank)));c[c.length-1].prepare(this.caster);c[c.length-1].castTimeInfo.base=2500;e.push({totalDamage:0,hits:0,crits:0,crits:0,resists:0,partialResistedDamage:0,timeSpentCasting:0});for(var d=0;0<=b;){a=0<a?a-d:0;this.caster.update(d);this.target.update(d);if(0>=a){for(d=0;d<c.length-1;d++)if(!this.target.hasSpell(c[d].spellInfo)){this.caster.cast(c[d],this.target);
c[d].results.hitResult==SpellMissInfo.SPELL_MISS_NONE?(e[d].hits+=1,c[d].results.critResult==SpellHitType.SPELL_HIT_TYPE_CRIT&&(e[d].crits+=1),e[d].totalDamage+=c[d].results.directDamage,e[d].partialResistedDamage+=c[d].results.resist):e[d].resists+=1;var a=c[d].spellInfo.startRecoveryTime,f=c[d].castTimeInfo.base,a=f>=a?f:a;e[d].timeSpentCasting+=a;break}if(0>=a){d=c.length-1;this.caster.cast(c[d],this.target);c[d].results.hitResult==SpellMissInfo.SPELL_MISS_NONE?(e[d].hits+=1,c[d].results.critResult==
SpellHitType.SPELL_HIT_TYPE_CRIT&&(e[d].crits+=1),e[d].totalDamage+=c[d].results.directDamage,e[d].partialResistedDamage+=c[d].results.resist):e[d].resists+=1;var a=c[d].spellInfo.startRecoveryTime,f=c[d].castTimeInfo.base,g=spellStore.lookupEntry(17941);this.caster.hasSpell(g)&&(f=0,this.caster.removeAurasBySpell(g));a=f>=a?f:a;e[d].timeSpentCasting+=a}}d=100;b-=d}for(d=0;d<c.length;d++)if(e[d].totalDamage+=c[d].results.dotDamage,e[d].procs=c[d].results.procs,b=c[d].durationInfo)e[d].uptime=b.duration*
e[d].hits;b={damage:0,hits:0,crits:0,resists:0,partiallyResisted:0,activeTime:0,dps:0,procs:0};for(d=0;d<e.length;d++)b.damage+=e[d].totalDamage,b.hits+=e[d].hits,b.crits+=e[d].crits,b.resists+=e[d].resists,b.partiallyResisted+=e[d].partialResistedDamage,b.activeTime+=e[d].timeSpentCasting;b.activeTime=b.activeTime>this.simVars.time?this.simVars.time:b.activeTime;b.activeTime=b.activeTime/1E3+"s";b.dps=b.damage/(this.simVars.time/1E3);this.spellInfo.useCorr&&(b.procs=c[1].results.procs);return{results:e,
totals:b}};function runSim(){var a=(new Date).getTime();ZeroTheory.Utils.debug=!1;var b=zt.run();ZeroTheory.Utils.debug=!0;a=(new Date).getTime()-a;ZeroTheory.Utils.console("log","Elapsed time: %i msec",a);presentResults(b)}function data_overlay_close(){$("#data_overlay").hide()}function presentResults(a){for(var b in a.totals)$("#"+b).text(a.totals[b]);$("#hits").text(a.totals.hits-a.totals.crits);$("#casts").text(a.totals.hits+a.totals.resists);$("#data_overlay").fadeIn(200)};
